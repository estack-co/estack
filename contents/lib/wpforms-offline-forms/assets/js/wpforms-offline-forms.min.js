!function(e){var t={isOffline:!1,forms:[],formsData:{},storage:{local:store.namespace("wpforms").namespace("offline"),expire:86400,set:function(e,t){var i=this.local.namespace(parseInt(e,10));i.set(i.size()+1,t,this.expire)},get:function(e){e=parseInt(e,10);var t=this.getAll(e),i={};return t.length>0&&(i=t.shift()),this.local.namespace(e).remove(i.entry_id),i},getAll:function(t){var i,o=this.local.namespace(parseInt(t,10)).getAll(),n=[];for(i in o)o.hasOwnProperty(i)&&!e.isEmptyObject(o[i])&&n.push({entry_id:i,entry:o[i]});return n},clearAll:function(e){this.local.namespace(parseInt(e,10)).clearAll()}},notifications:{$_form:!1,_actions:[],setForm:function(e){return this.$_form=e,this._clearActions(),this},setActions:function(e){if(!e)return this._clearActions(),this;var t;for(t in e)e.hasOwnProperty(t)&&this._actions.push({key:t,label:e[t]});return this},_clearActions:function(){this._actions=[]},_getNotificationTemplate:function(){return e('<div class="wpforms-notice wpforms-info"></div>')},_getActionsTemplate:function(){return e('<div class="wpforms-notice-actions"></div>')},_getActionTemplate:function(){return e('<a class="wpforms-notice-action"></a>')},display:function(t,i){var o="non-dismissible";i&&(o="");var n=this._getNotificationTemplate().addClass(o).html(t);if(this._actions.length){var s,r=this._getActionsTemplate();for(s in this._actions)r.append(this._getActionTemplate().attr("href","#"+encodeURIComponent(this._actions[s].key)).text(this._actions[s].label));n.append(r)}e(".wpforms-field-container",this.$_form).before(n);var f=this.$_form;e("html, body").animate({scrollTop:f.offset().top-100},750)},hide:function(){e(".wpforms-notice",this.$_form).not(".non-dismissible").remove()},hideAll:function(){e(".wpforms-notice",this.$_form).remove()}},init:function(){t.populateForms(),window.addEventListener("online",t.connectionEvent),window.addEventListener("offline",t.connectionEvent),e(document).on("wpformsReady",t.checkConnectivityLoop),e(document).on("wpformsReady",t.checkOfflineRecords),e(document).on("wpformsReady",t.saveFormDefaults),t.bindUIActions()},populateForms:function(){e.each(wpforms_offline_forms.offline_form_ids,function(i,o){t.forms.push(e("#wpforms-"+o))})},checkConnectivityLoop:function(){var e=parseInt(wpforms_offline_forms.check_connection_interval,10);t._isNaturalNumber(e)&&setInterval(function(){t.processConnectivityAjaxCheck(null)},1e3*e)},processConnectivityAjaxCheck:function(i){var o=parseInt(wpforms_offline_forms.check_connection_timeout,10);t._isNaturalNumber(o)&&e.ajax({method:"HEAD",url:wpforms_offline_forms.check_connection_url,cache:!1,timeout:1e3*o,complete:function(e,o){0!==e.status&&"timeout"!==o?(t.isOffline=!1,navigator.onLine=!0,t.notificationOfflineHide()):(t.isOffline=!0,navigator.onLine=!1,t.notificationOfflineDisplay()),"function"==typeof i&&i()}})},checkOfflineRecords:function(){e.each(t.forms,function(e,i){var o=t.storage.getAll(i.find("form").data("formid")),n=t.notifications.setForm(i);n.hideAll(),0!==o.length&&(1===o.length?(t.isOffline||n.setActions({offline_restore:wpforms_offline_forms.text_restore_btn,offline_clear:wpforms_offline_forms.text_clear_btn}),n.display(wpforms_offline_forms.text_restore_single)):(t.isOffline||n.setActions({offline_restore:wpforms_offline_forms.text_restore_btn,offline_clear:wpforms_offline_forms.text_clear_all_btn}),n.display(wpforms_offline_forms.text_restore_plural)))})},saveFormDefaults:function(){e.each(wpforms_offline_forms.offline_form_ids,function(i,o){t.formsData[o]=e("#wpforms-"+o).find("form").serializeArray()})},processRestoreFormDefault:function(i){var o=e("#wpforms-"+i);if(void 0!==t.formsData[i]&&o.length){if(o.find("form").deserialize(t.formsData[i],{change:function(){e(this).trigger("change")}}),o.find(".wpforms-page-indicator").length)if(o.find('.wpforms-page-prev[data-page="2"]').length)o.find(".wpforms-page").hide(),o.find('.wpforms-page-prev[data-page="2"]').trigger("click");else{var n=e('<button class="wpforms-page-button wpforms-page-prev"></button>');n.css("visibility","hidden").data("action","prev").data("page","2").data("formid",i),o.find(".wpforms-page").hide(),o.find(".wpforms-field-pagebreak").first().append(n),n.trigger("click"),n.remove()}this.checkOfflineRecords()}},bindUIActions:function(){var i=this;e.each(t.forms,function(e,t){i.processFormSave(t.find("form"))}),e.each(t.forms,function(t,o){e(document).on("click","#"+o.attr("id")+' .wpforms-submit-container button[type="submit"]',function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();var o=e(this),n=o.data("alt-text"),s=e(this).closest("form"),r=o.text();o.prop("disabled",!0),n&&o.text(n),i.processConnectivityAjaxCheck(function(){s.submit(),o.prop("disabled",!1),o.text(r)})})}),e(document).on("click",'.wpforms-notice-action[href="#offline_restore"]',function(t){t.preventDefault(),i.processRestore(e(this).closest("form"))}),e(document).on("click",'.wpforms-notice-action[href="#offline_clear"]',function(t){t.preventDefault(),i.processClearAll(e(this).closest("form"))})},processFormSave:function(i){i.submit(function(o){var n=parseInt(i.data("formid"),10);if(!t.isOffline)return!0;o.preventDefault(),o.stopPropagation(),o.stopImmediatePropagation(),e(".wpforms-field",i).each(function(t,i){(e(i).hasClass("wpforms-field-password")||e(i).hasClass("wpforms-field-credit-card")||e(i).hasClass("wpforms-field-signature"))&&e(i).find("input, select").attr("disabled","disabled")});var s=i.serializeArray();e(".wpforms-field",i).each(function(t,i){(e(i).hasClass("wpforms-field-password")||e(i).hasClass("wpforms-field-credit-card")||e(i).hasClass("wpforms-field-signature"))&&e(i).find("input, select").removeAttr("disabled")}),t.storage.set(n,s),t.processRestoreFormDefault(n)})},processRestore:function(t){var i=this.storage.get(t.data("formid"));t.deserialize(i.entry,{change:function(){e(this).trigger("change")}}),this.checkOfflineRecords()},processClearAll:function(e){this.storage.clearAll(e.data("formid")),this.notifications.setForm(e).hideAll()},connectionEvent:function(){t.connectionUpdateStatus()},connectionUpdateStatus:function(){void 0!==navigator.onLine&&(t.isOffline=!navigator.onLine,e("body").toggleClass("wpforms-is-offline",t.isOffline),t.isOffline?t.notificationOfflineDisplay():t.notificationOfflineHide())},notificationOfflineDisplay:function(){e.each(t.forms,function(e,i){var o=t.notifications.setForm(i);o.hideAll(),o.display(wpforms_offline_forms.text_offline,!0)})},notificationOfflineHide:function(e){this.notifications.setForm(e).hide(),this.checkOfflineRecords()},_isNaturalNumber:function(e){return e>=0&&Math.floor(e)===+e}};t.init()}(jQuery);